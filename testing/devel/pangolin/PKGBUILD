# vim: set ts=2 sw=2 et:
# $Id:.
# NuxSFM Maintainer : Pierre-Yves Paranthoen <nuxsfm at you know what gmail dot com>

pkgname=('Pangolin-git')
pkgver=v0.0
pkgrel=1
pkgdesc="Pangolin is a lightweight portable rapid development library for managing OpenGL display / interaction and abstracting video input"
arch=('x86_64')
url="https://github.com/mp3guy/Pangolin"
groups=('computer-vision' 'sfm')
license=('MPL 2.0')
depends=('glew' 'boost' 'ffmpeg' 'libdc1394' 'libuvc-git' 'libjpeg' 'libpng' 'openni2' )
makedepends=('cmake' 'git' 'make' 'gcc' 'dejagnu' 'boost')

# The git repo is detected by the 'git:' or 'git+' beginning. The branch
# '$pkgname' is then checked out upon cloning, expediating versioning:

source=("$pkgname"::'git+https://github.com/mp3guy/Pangolin.git')
        
# Because the sources are not static, skip Git checksum:
md5sums=('SKIP')

prepare() {
    cd "$srcdir/$pkgname"
    # Use the tag of the last commit
    git describe --long | sed -E 's/([^-]*-g)/r\1/;s/-/./g'
        
}

build() {
    unset CPPFLAGS
    unset CFLAGS
    unset CXXFLAGS
    unset LDFLAGS
    cd "$srcdir/$pkgname/src"
    [[ -d build ]] && rm -r build
    mkdir build
    cd build
    cmake -DCPP11_NO_BOOST=1 ..
    make -j8
}

package() {

# to check to simplify exe copy: find -type f -executable -exec file -i '{}' \; | grep 'x-executable; charset=binary'
    pkgdesc="Pangolin is a lightweight portable rapid development library for managing OpenGL display / interaction and abstracting video input."
    provides=('pangolin')
    conflicts=('pangolin')
    replaces=('pangolin')
            
    cd "$srcdir/$pkgname/src/build"        
    install -dm755 "${pkgdir}"/opt/pangolin
    install -dm644 "${pkgdir}"/opt/pangolin 
    
}

